{% extends 'UserPage/Admin/index.html.twig' %} {% block title %}Inventory
Management{% endblock %} {% block admin_content %}
<div class="flex">
    <div class="flex-1 flex flex-col bg-gray-50">
        <main class="flex-1 overflow-y-auto">
            <section
                x-data='{
                    openModal: false,
                    modalHtml: "",
                    isLoading: false,

                    search: "",
                    filter: "",

                    loadModal(url) {
                        this.openModal = true;
                        this.isLoading = true;

                        this.modalHtml = `
                            <div class="flex items-center justify-center py-10 text-gray-500">
                                <svg class="animate-spin h-6 w-6 mr-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                </svg>
                                Loading...
                            </div>`;

                        fetch(url)
                            .then(r => r.text())
                            .then(html => {
                                this.modalHtml = html;
                                this.isLoading = false;
                            })
                            .catch(err => {
                                console.error(err);
                                this.modalHtml = `
                                    <div class="text-center py-10 text-red-500">
                                        Error loading content.
                                    </div>`;
                                this.isLoading = false;
                            });
                    }
                }'
                class="space-y-4"
            >
                <!-- Unified Header (same layout as Users & Roles) -->
                <div
                    class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"
                >
                    <div>
                        <h2 class="text-xl font-semibold">
                            Inventory Management
                        </h2>
                        <p class="text-sm text-gray-500">
                            Realtime stock, low ammo alerts, and maintenance
                        </p>
                    </div>

                    <div class="flex items-center gap-2">
                        <input
                            type="text"
                            placeholder="Search units..."
                            x-model="search"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none w-64 text-sm"
                        />

                        <select
                            x-model="filter"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm"
                        >
                            <option value="">All</option>
                            <option value="in-stock">In Stock</option>
                            <option value="out-of-stock">Out of Stock</option>
                        </select>

                        {% set buttons = [ { label: '+ Add Unit', route:
                        'app_unit_new' }, { label: '+ Add Stocks', route:
                        'app_stocks_new' } ] %} {% for btn in buttons %}
                        <button
                            @click="loadModal('{{ path(btn.route) }}')"
                            class="{% if btn.route == 'app_stocks_new' %} border-2 border-yellow-400 text-yellow-700 hover:bg-yellow-50 {% else %} bg-primary text-white {% endif %} text-sm font-medium px-4 py-2 rounded-lg shadow"
                        >
                            {{ btn.label }}
                        </button>
                        {% endfor %}

                        <!-- Stock Logs Button -->
                        {% if stocks is defined %}
                        <div class="flex justify-end">
                            <button
                                @click="loadModal('{{
                                    path('app_stock_logs')
                                }}')"
                                class="border border-gray-300 text-gray-700 hover:bg-gray-100 text-sm font-medium px-4 py-2 rounded-lg shadow"
                            >
                                ðŸ“¦ View Stock Logs
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Stock Overview (Units Table) -->
                <div
                    class="mt-2 overflow-x-auto rounded-2xl shadow max-h-[500px] overflow-y-auto"
                >
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead
                            class="bg-gray-100 text-gray-700 uppercase text-xs tracking-wider sticky top-0 z-10"
                        >
                            <tr>
                                <th class="px-4 py-2 text-left">Name</th>
                                <th class="px-4 py-2 text-left">Price</th>
                                <th class="px-4 py-2 text-left">Stocks</th>
                                <th class="px-4 py-2 text-left">Description</th>
                                <th class="px-4 py-2 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            {% if units is defined and units|length > 0 %} {%
                            for unit in units %} {% set totalQuantity = 0 %} {%
                            for s in unit.stock %} {% set totalQuantity =
                            totalQuantity + (s.quantity ?: 0) %} {% endfor %}
                            <tr
                                class="hover:bg-gray-50"
                                x-data="{
                            unitName: '{{ unit.name|lower|e('js') }}',
                            unitQty: {{ totalQuantity|default(0) }}
                        }"
                                x-show="
                            unitName.includes(search.toLowerCase()) &&
                            (filter === '' ||
                                (filter === 'in-stock' && unitQty > 0) ||
                                (filter === 'out-of-stock' && unitQty <= 0))
                        "
                            >
                                <td class="px-4 py-2 font-medium text-gray-700">
                                    {{ unit.name }}
                                </td>
                                <td class="px-4 py-2">{{ unit.price ?? 0 }}</td>
                                <td class="px-4 py-2">{{ totalQuantity }}</td>
                                <td class="px-4 py-2">
                                    {{ unit.description }}
                                </td>
                                <td class="px-4 py-2 space-x-3">
                                    {{
                                        include(
                                            "UserPage/Admin/forms/unit/_actions_link.html.twig"
                                        )
                                    }}
                                </td>
                            </tr>
                            {% endfor %} {% else %}
                            <tr>
                                <td
                                    colspan="6"
                                    class="px-4 py-6 text-center text-gray-400"
                                >
                                    No units found.
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

                <!-- Reuse the same modal component -->
                <div
                    x-show="openModal"
                    class="fixed inset-0 flex items-center justify-center bg-black/20 backdrop-blur-md z-50"
                    @click.self="openModal = false"
                    x-transition.opacity
                >
                    <div
                        class="bg-white rounded-xl shadow-xl w-[700px] max-h-[80vh] overflow-y-auto p-6 transform transition-all duration-300"
                        x-transition:enter="ease-out duration-200"
                        x-transition:enter-start="opacity-0 scale-95"
                        x-transition:enter-end="opacity-100 scale-100"
                        x-transition:leave="ease-in duration-150"
                        x-transition:leave-start="opacity-100 scale-100"
                        x-transition:leave-end="opacity-0 scale-95"
                        x-html="modalHtml"
                    ></div>
                </div>
            </section>
        </main>
    </div>
</div>

{% include 'UserPage/Admin/_modals.html.twig' %} {% endblock %}
