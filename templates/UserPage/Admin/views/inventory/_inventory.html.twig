<section
    x-data='{
        // modal state
        openModal: false,
        modalUrl: "",
        modalHtml: "",
        isLoading: false,

        // filters
        search: "",
        filter: "",

        // load modal dynamically
        loadModal(url) {
            this.openModal = true;
            this.isLoading = true;

            // Show spinner while fetching
            this.modalHtml = `
                <div class="flex items-center justify-center py-10 text-gray-500">
                    <svg class="animate-spin h-6 w-6 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                    </svg>
                    Loading...
                </div>`;

            fetch(url)
                .then(r => r.text())
                .then(html => {
                    this.modalHtml = html;
                    this.isLoading = false;
                })
                .catch(err => {
                    console.error(err);
                    this.modalHtml = `
                        <div class="text-center py-10 text-red-500">
                            Error loading content.
                        </div>`;
                    this.isLoading = false;
                });
        }
    }'
    x-show="view === 'inventory'"
>
    <!-- Header -->
    <div class="flex items-center justify-between mb-4">
        <div>
            <h2 class="text-xl font-semibold">Inventory Management</h2>
            <p class="text-sm text-gray-500">
                Realtime stock, low ammo alerts, maintenance
            </p>
        </div>
        <div>
            <button
                @click="loadModal('{{ path('app_unit_new') }}')"
                class="bg-primary hover:bg-blue-700 text-white text-sm font-medium px-4 py-2 rounded-lg shadow"
            >
                + Add Unit
            </button>
        </div>
    </div>

    <!-- Stock Overview -->
    <div class="bg-white rounded-2xl shadow p-4 lg:col-span-2">
        <h3 class="text-xs font-medium text-gray-500 mb-3">Stock Overview</h3>

        <!-- Controls -->
        <div class="flex items-center justify-between mb-4">
            <input
                type="text"
                placeholder="Search units..."
                x-model="search"
                class="w-1/2 px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring focus:border-blue-300"
            />

            <select
                x-model="filter"
                class="px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring focus:border-blue-300"
            >
                <option value="">All</option>
                <option value="in-stock">In Stock</option>
                <option value="out-of-stock">Out of Stock</option>
            </select>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                    <tr>
                        <th class="px-4 py-2 text-left">ID</th>
                        <th class="px-4 py-2 text-left">Name</th>
                        <th class="px-4 py-2 text-left">Price</th>

                        {# <th class="px-4 py-2 text-left">Quantity</th> #}

                        <th class="px-4 py-2 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% if units is defined and units|length > 0 %} {% for unit
                    in units %}
                    <tr
                        class="hover:bg-gray-50"
                        x-data="{
                                    unitName: &quot;{{
                            unit.name | lower
                        }}&quot;,
                                    unitQty: {{ unit.type.quantity ?? 0 }}
                                }"
                        x-show="
                                    unitName.includes(search.toLowerCase()) &&
                                    (filter === '' ||
                                        (filter === 'in-stock' && unitQty > 0) ||
                                        (filter === 'out-of-stock' && unitQty <= 0)
                                    )
                                "
                    >
                        <td class="px-4 py-2">{{ unit.id }}</td>
                        <td class="px-4 py-2 font-medium text-gray-700">
                            {{ unit.name }}
                        </td>
                        <td class="px-4 py-2">{{ unit.price ?? 0 }}</td>

                        {# <td class="px-4 py-2">{{ unit.type.quantity ?? 0 }}</td> #}
                        <td class="px-4 py-2 space-x-3">
                            {{ include("unit/_show_link.html.twig") }}
                            {{ include("unit/_edit_link.html.twig") }}
                            {{ include("unit/_delete_form.html.twig") }}
                        </td>
                    </tr>
                    {% endfor %} {% else %}
                    <tr>
                        <td
                            colspan="4"
                            class="px-4 py-6 text-center text-gray-400"
                        >
                            No units found.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Maintenance & Suppliers Sections -->
    <div class="bg-white rounded-2xl shadow p-4 mt-4">
        <h3 class="text-xs font-medium text-gray-500">Maintenance Schedule</h3>
        <div class="mt-3 space-y-2 text-sm">
            <div class="flex justify-between">
                <span>M4A1 - Serial M4-121 (Due)</span>
                <span class="text-red-600">2025-09-28</span>
            </div>
            <div class="flex justify-between">
                <span>Pistol-45 - P45-23 (Ok)</span>
                <span class="text-green-600">2026-02-01</span>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow p-4 mt-4">
        <h3 class="text-xs font-medium text-gray-500">Suppliers</h3>
        <div class="mt-3 text-sm">
            <p class="font-medium">Alpha Supplies</p>
            <p class="text-xs text-gray-500">Contact: +63 912 345 6789</p>
        </div>
    </div>

    <!-- Modal -->
    <div
        x-show="openModal"
        class="fixed inset-0 flex items-center justify-center bg-black/20 backdrop-blur-md z-50"
        @click.self="openModal = false"
        x-transition.opacity
    >
        <div
            class="bg-white rounded-xl shadow-xl w-[500px] max-h-[80vh] overflow-y-auto p-6 transform transition-all duration-300"
            x-transition:enter="ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="ease-in duration-150"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            x-html="modalHtml"
        ></div>
    </div>
</section>
