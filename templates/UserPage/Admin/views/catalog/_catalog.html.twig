{% extends 'UserPage/Admin/index.html.twig' %} {% block title %}Firearm &
Equipment Catalog{% endblock %} {% block admin_content %}
<div x-data="catalog()" class="flex flex-col gap-4">
    <!-- Filters -->
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Firearm & Equipment Catalog</h2>
        <div class="flex items-center gap-2">
            <!-- Category Filter -->
            <select
                x-model="filter.category"
                class="px-3 py-2 border rounded-xl border-gray-200"
            >
                <option value="">All Categories</option>
                {% for type in unitTypes %}
                <option value="{{ type.name }}">{{ type.name }}</option>
                {% endfor %}
            </select>

            <input
                x-model="filter.q"
                @input.debounce.300="searchCatalog()"
                placeholder="Model / Serial #"
                class="px-3 py-2 border rounded-xl border-gray-200"
            />
        </div>
    </div>

    <!-- Catalog Table -->
    <div
        class="overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-200 max-h-[500px] overflow-y-auto"
    >
        <table class="min-w-full divide-y divide-gray-200 text-sm">
            <thead
                class="bg-gray-100 text-gray-700 uppercase text-xs tracking-wider sticky top-0 z-10"
            >
                <tr>
                    <th class="px-4 py-3 text-left">Owner</th>
                    <th class="px-4 py-3 text-left">Purchased Date</th>
                    <th class="px-4 py-3 text-left">Model</th>
                    <th class="px-4 py-3 text-left">Serial #</th>
                    <th class="px-4 py-3 text-left">Condition</th>
                    <th class="px-4 py-3 text-left">Status</th>
                    <th class="px-4 py-3 text-left">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for unit in unitInstances %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">
                        {{
                            unit.weaponType
                                ? unit.owner.fullname
                                : "Not Yet Purchased"
                        }}
                    </td>
                    <td class="px-4 py-3">
                        {{ unit.purchasedDate ? unit.purchasedDate|date('Y-m-d') : "Not Yet Purchased" }}
                    </td>
                    <td class="px-4 py-3">
                        {{
                            unit.weaponType
                                ? unit.weaponType.name
                                : "Not Yet Purchased"
                        }}
                    </td>
                    <td class="px-4 py-3">{{ unit.serialNumber }}</td>
                    <td class="px-4 py-3">{{ unit.itemStatus.value }}</td>
                    <td class="px-4 py-3">
                        {% if unit.status.value == 'active' %}
                        <span class="text-sm font-medium text-green-600">{{
                            unit.status.value
                        }}</span>
                        {% else %}
                        <span class="text-sm font-medium text-red-600">{{
                            unit.status.value
                        }}</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 flex gap-2">
                        <button
                            @click="openModal('issue', { itemId: {{
                                unit.id
                            }} })"
                            class="bg-primary text-white text-xs font-medium px-3 py-1 rounded-lg shadow transition-transform transform hover:scale-105"
                        >
                            Issue
                        </button>
                        <button
                            @click="openModal('editItem', { itemId: {{
                                unit.id
                            }} })"
                            class="bg-secondary text-white text-xs font-medium px-3 py-1 rounded-lg shadow transition-transform transform hover:scale-105"
                        >
                            Edit
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="px-4 py-3 text-center text-gray-400">
                        No records found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function catalog() {
        return {
            filter: {
                category: "",
                q: "",
            },
            searchCatalog() {
                const rows = document.querySelectorAll("tbody tr");
                rows.forEach((row) => {
                    const type = row.children[0].innerText.toLowerCase();
                    const model = row.children[1].innerText.toLowerCase();
                    const serial = row.children[2].innerText.toLowerCase();
                    const query = this.filter.q.toLowerCase();
                    const category = this.filter.category.toLowerCase();

                    const matchesQuery =
                        model.includes(query) || serial.includes(query);
                    const matchesCategory =
                        category === "" || type === category;

                    row.style.display =
                        matchesQuery && matchesCategory ? "" : "none";
                });
            },
            openModal(type, payload) {
                console.log(`Open modal '${type}' for item`, payload.itemId);
            },
        };
    }
</script>
{% endblock %}
