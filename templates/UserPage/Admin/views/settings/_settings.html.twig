{% extends 'UserPage/Admin/index.html.twig' %}

{% block title %}User Settings
{% endblock %}

{% block admin_content %}
	<div>
		<h2 class="text-xl font-semibold">Account Settings</h2>
		<p class="text-sm text-gray-500">
			Edit your profile here
		</p>
	</div>

	<div
		class="flex flex-col md:flex-row gap-6">

		{# --- LEFT COLUMN: ACCOUNT OVERVIEW --- #}
		<div class="flex-1 bg-white rounded-xl shadow-lg p-6 md:p-8">
			<h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
				<svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
				</svg>
				Account Profile
			</h3>

			<div class="flex items-center gap-4 mb-8">
				<div class="h-10 w-10 rounded-full bg-gray-600 flex items-center justify-center text-2xl text-white font-semibold">
					{{ app.user.getFullName() ? app.user.getFullName()|first|upper : 'U' }}
				</div>
				<div>
					<div class="text-lg font-bold text-gray-800">{{ app.user.getFullName() }}</div>
					<div class="text-sm text-gray-500">{{ app.user.getEmail() }}</div>
				</div>
			</div>

			<h4 class="text-sm font-semibold text-gray-600 tracking-wide uppercase mb-2">
				Personal Information
			</h4>

			<div class="space-y-4">
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Full Name</div>
					<div class="col-span-2 text-sm text-gray-900 font-semibold">{{ app.user.getFullName() }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Email</div>
					<div class="col-span-2 text-sm text-gray-900 font-semibold">{{ app.user.getEmail() }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Contact Number</div>
					<div class="col-span-2 text-sm text-gray-900 font-semibold">{{ app.user.getContactNumber() ?? '—' }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Bio</div>
					<div class="col-span-2 text-sm text-gray-900">{{ app.user.getBio() ?? '—' }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Status</div>
					<div class="col-span-2">
						{% if app.user.getStatus().value == 'ACTIVE' %}
							<span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700">Active</span>
						{% else %}
							<span class="px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-700">Inactive</span>
						{% endif %}
					</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2 border-b border-gray-100">
					<div class="text-sm font-medium text-gray-500">Member Since</div>
					<div class="col-span-2 text-sm text-gray-900">{{ app.user.getCreatedAt() ? app.user.getCreatedAt()|date('F j, Y') : '—' }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2">
					<div class="text-sm font-medium text-gray-500">Last Updated</div>
					<div class="col-span-2 text-sm text-gray-900">{{ app.user.getUpdatedAt() ? app.user.getUpdatedAt()|date('F j, Y h:i A') : '—' }}</div>
				</div>
				<div class="grid grid-cols-3 gap-4 py-2">
					<div class="text-sm font-medium text-gray-500">Role</div>
					<div class="col-span-2 text-sm text-gray-900 font-semibold">
						{{ app.user.getRoles()
                        |filter(role => role != 'ROLE_USER')
                        |map(role => role|replace({'ROLE_':''}))
                        |join(', ') }}
					</div>
				</div>
			</div>
		</div>

		{# --- RIGHT COLUMN: EDIT FORM WITH BLUR AND CONFIRMATION --- #}
		<div
			x-data="{ openModal: false, blurForm: true }" class="flex-1 relative">
			{# Overlay blur effect #}
			<div :class="blurForm ? 'absolute inset-0 bg-white/70 backdrop-blur-md z-10 flex items-center justify-center' : ''">
				<template x-if="blurForm">
					<button @click="openModal = true" class="font-medium py-2 px-4 rounded-xl shadow-md transition-transform
						               bg-primary text-white hover:shadow-lg hover:scale-105">
						Edit Profile
					</button>
				</template>
			</div>

			{# The actual form #}
			<div :class="blurForm ? 'pointer-events-none opacity-70' : ''" class="bg-white rounded-xl shadow-lg p-6 md:p-8 transition-all duration-300">

				<h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
					<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-indigo-500" fill="none" viewbox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20v-2a4 4 0 00-3-3.87m-3-.13a4 4 0 010-8 4 4 0 010 8zM9 20v-2a4 4 0 013-3.87"/>
					</svg>
					Edit Profile
				</h3>

				<p class="text-sm text-gray-500 mb-4">
					Update your account information and change your password.
				</p>

				{{ form_start(form, {'attr': {'class': 'space-y-4'}}) }}

				<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
					<div>{{ form_row(form.fullName) }}</div>
					<div>{{ form_row(form.email) }}</div>
					<div>{{ form_row(form.contactNumber) }}</div>
					<div>{{ form_row(form.bio) }}</div>
				</div>

				<div>
					<h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
						<svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2v5a2 2 0 01-2 2h-2a2 2 0 01-2-2v-5a2 2 0 012-2h2zM7 9H5a2 2 0 00-2 2v5a2 2 0 002 2h2m0-6V7a4 4 0 018 0v2"/>
						</svg>
						Change Password
					</h3>
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
						<div>{{ form_row(form.currentPassword) }}</div>
						<div>{{ form_row(form.newPassword) }}</div>
					</div>
					<div>{{ form_row(form.confirmPassword) }}</div>
				</div>

				<button type="submit" class="font-medium py-2 px-4 rounded-xl shadow-md transition-transform
						               bg-primary text-white hover:shadow-lg hover:scale-105">
					Update Profile
				</button>

				{{ form_end(form) }}
			</div>

			{# Confirmation Modal #}
			<div x-show="openModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
				<div class="bg-white rounded-xl p-6 md:p-8 max-w-md w-full shadow-lg text-center">
					<h2 class="text-xl font-semibold mb-4">Confirm Action</h2>
					<p class="mb-6 text-gray-600">
						If you proceed to edit your profile or change your password, it cannot be undone. Are you sure you want to continue?
					</p>
					<div class="flex justify-center gap-4">
						<button @click="blurForm = false; openModal = false" class="font-medium py-2 px-4 rounded-xl shadow-md transition-transform
						               bg-primary text-white hover:shadow-lg hover:scale-105">
							Proceed
						</button>
						<button @click="openModal = false" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-xl hover:bg-gray-400">
							Cancel
						</button>
					</div>
				</div>
			</div>
		</div>

	</div>
{% endblock %}
