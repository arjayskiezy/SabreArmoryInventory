{% extends 'UserPage/Admin/index.html.twig' %}

{% block title %}Report Equipment Issue
{% endblock %}

{% block admin_content %}
	<div class="space-y-8">

		<header class="pb-4 border-b border-gray-200">
			<h2 class="text-3xl font-extrabold text-gray-900 tracking-tight">Report Equipment Issue</h2>
			<p class="mt-1 text-base text-gray-600">Submit a detailed report if your assigned unit has encountered a problem.</p>
		</header>

		{% for label, messages in app.flashes %}
			{% for message in messages %}
				{% set color_class = label == 'success' ? 'bg-green-50 border-green-400 text-green-700' : 'bg-red-50 border-red-400 text-red-700' %}
				<div class="p-4 border-l-4 {{ color_class }} rounded-lg shadow-sm" role="alert">
					<p class="font-medium">{{ message }}</p>
				</div>
			{% endfor %}
		{% endfor %}

		<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

			<div class="lg:col-span-1 bg-white rounded-xl shadow-2xl overflow-hidden p-6 border border-gray-100">
				<h3 class="text-xl font-bold text-gray-800 pb-3">Submit a New Report</h3>

				{{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

				<div>
					{{ form_label(form.unit, 'Unit to Report', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
					{{ form_widget(form.unit, {'attr': {'class': 'w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out'}}) }}
					{{ form_errors(form.unit, {'attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
				</div>

				<div>
					{{ form_label(form.itemStatus, 'Current Unit Status', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
					{{ form_widget(form.itemStatus, {'attr': {'class': 'w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out'}}) }}
					{{ form_errors(form.itemStatus, {'attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
				</div>

				<div>
					{{ form_label(form.notes, 'Detailed Issue Description', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
					{{ form_widget(form.notes, {'attr': {'class': 'w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 h-32 resize-none transition duration-150 ease-in-out', 'placeholder': 'Describe the issue clearly (e.g., "Barrel not align").'}}) }}
					{{ form_errors(form.notes, {'attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
				</div>

				<button type="submit" class="w-full bg-primary text-white font-semibold px-4 py-3 rounded-xl shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:-translate-y-0.5">
					Submit Report
				</button>
				{{ form_end(form) }}
			</div>

			<div class="lg:col-span-2 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-3xl p-8 border border-gray-100">
    <h3 class="text-2xl font-extrabold text-gray-900 mb-6 border-b-2 border-indigo-100 pb-3 tracking-tight">Your Assigned Units</h3>
    
    <div class="space-y-4">
        {% for unit in units %}
            {% set status_info = {
                'URGENT': {'bg': 'bg-red-50 text-red-800', 'dot': 'bg-red-600', 'ring': 'ring-red-400', 'border': 'border-red-300'},
                'MAINTENANCE': {'bg': 'bg-yellow-50 text-yellow-800', 'dot': 'bg-yellow-600', 'ring': 'ring-yellow-400', 'border': 'border-yellow-300'},
                'GOOD': {'bg': 'bg-green-50 text-green-800', 'dot': 'bg-green-600', 'ring': 'ring-green-400', 'border': 'border-green-300'}
            } %}
            {% set current_status = status_info[unit.itemStatus.value] | default(status_info['GOOD']) %}
            {% set unit_type_initial = unit.unitType ? unit.unitType.name|first|upper : 'U' %}

            <div class="relative flex flex-col sm:flex-row sm:items-center justify-between p-5 {{ current_status.bg }} rounded-xl border-2 {{ current_status.border }} shadow-md hover:shadow-xl hover:scale-[1.01] transition-all duration-300 ease-in-out cursor-pointer group">
                
                <div class="flex items-center space-x-4 mb-3 sm:mb-0 min-w-0">
                    
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-primary text-white font-semibold flex items-center justify-center text-sm shadow-inner group-hover:ring-2 {{ current_status.ring }} transition-all">
                        {{ unit_type_initial }}
                    </div>

                    <div class="truncate">
                        <div class="font-extrabold text-xl text-gray-700 group-hover:text-indigo-900 transition-colors">
                            {{ unit.serialNumber }}
                        </div>
                        <div class="text-xs text-gray-500 mt-0.5">
                            {{ unit.unitType ? unit.unitType.name : 'Unspecified Unit' }}
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row sm:items-center gap-4 text-sm flex-shrink-0">
                    
                    <span class="inline-flex items-center gap-2 font-bold px-3 py-1 rounded-full text-xs uppercase tracking-wider bg-white shadow-sm border border-gray-200">
                        <span class="inline-block w-2.5 h-2.5 rounded-full {{ current_status.dot }}"></span>
                        {{ unit.itemStatus.value }}
                    </span>
                    
                </div>
            </div>
        {% else %}
            <p class="text-center text-gray-500 py-10 bg-gray-100 rounded-xl border border-gray-200 shadow-inner">
                You have no assigned units to report an issue for.
            </p>
        {% endfor %}
    </div>
</div>

		</div>

	</div>
{% endblock %}
